# FTP 원리

[FTP 통신 동작과정 및 기본 원리](https://hack-cracker.tistory.com/133)

FTP

파일 전송 프로토콜 - TCP/IP 프로토콜을 가지고 서버와 클라이언트 사이의 파일 전송을 하기 위한 프로토콜.

FTP는 파일 전송 전용 서비스라는 특징과 인터넷을 통한 파일 송수신 만을 고려한 서비스(프로토콜) 이기 때문에, 동작 방식이 대단히 단순하고 직관적이다. 그렇기 때문에 사용법도 간단하고, 빠른 속도로 많은 파일을 주고 받을 수 있다는 장점이 있다.

PORT

21 - 전송을 제어하기 위해

20 - 실제 데이터를 전송하기 위해

1.  능동(Active) 모드
    
    ![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8b0d41e9-4f93-4621-a7b3-58370d9c273c/ftp-.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8b0d41e9-4f93-4621-a7b3-58370d9c273c/ftp-.png)
    
    1.  클라이언트에서 FTP 서버의 21번 포트로 접속을 시도하고, 사용할 두번째 포트를 서버에 알려준다.
    2.  서버는 ACK 응답 후, 서버의 20번 포트는 클라이언트가 알려준 두번째 포트로 접속을 시도.
    3.  클라이언트 ACK

-   클라이언틀가 로그인하게 되면 서버에게 '데이터 전송을 위해 내쪽의 XXXX포트로 접속해!' → 서버는 20번 포트를 이용하여 클라이언트가 알려준 포트로 접속 후 데이터 전송

능동모드의 문제점

-   서버가 클라이언트가 알려준 포트로 접속을 시도하는 것.

이때 클라이언트PC의 내부적인 환경요인인 방화벽, FTP를 제대로 인식하지 못하는 공유기 문제로 FTP가 접속이 제대로 되지 않을 수 있다. 접속이 되더라도 이후 데이터 목록을 받아오지 못하는 에러가 발생할 수 있다.

수동(Passive) 모드

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/dd58d30f-986f-4193-ae2a-f3fd82de36c2/ftp-.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/dd58d30f-986f-4193-ae2a-f3fd82de36c2/ftp-.png)

서버가 클라이언트에 접속을 시도하는 비정상적인 능동모드에 대한 문제점을 해결하기 위해 수동 모드가 등장했다.

1.  클라이언트가 서버의 21번 포트로 접속을 시도하면, 서버에서는 서버가 사용할 두번째 포트를 알려준다
2.  클라이언트는 다른 포트를 열어 서버가 알려준 포트로 접속을 시도하고, 서버는 ACK로 응답한다
3.  수동 모드에서는 두 번째 data 포트로써 사용했던 20번 포트를 사용하지 않고, 1024 ~ 65535 사이의 임의의 비 특권 포트를 사용한다.

FTP 보안 취약점

-   사용자 인증정보에서 암호화 부재
-   계정 로그인의 인증 취약점을 악용한 Brute force 공격
-   Sniffing 공격으로 인한 인증정보 유출
-   익명 (Anonymous) FTP 취약
-   FTP 바운스 공격. 명령 채널과 파일 전송 채널이 별도로 존재하므로 실제 파일을 전송받는 클라이언트가 바뀔 수 있다는 취약점이 존재함.
